#:kivy 2.1.0

<RootLayout>:
    orientation: 'vertical'
    
    TitleBar:
        id: title_bar
        orientation: 'horizontal'
        padding: (dp(5), 0)
        
        MDLabel:
            text: "JustMessenger"
            size_hint_x: 1.0
            halign: 'left'
            valign: 'center'
        
        MDIconButton:
            icon: 'minus'
            on_release: app.get_running_app().root_window.minimize()
        MDIconButton:
            icon: 'checkbox-blank-outline'
            on_release: app.get_running_app().root_window.maximize() if app.get_running_app().root_window.size != (1920, 1080) else app.get_running_app().root_window.restore()
        MDIconButton:
            icon: 'close'
            on_release: app.stop()

    ChatLayout:
        id: chat_layout

<ChatLayout>:
    orientation: 'horizontal'
    spacing: 10
    padding: 10

    BoxLayout:
        id: emoji_panel
        orientation: 'vertical'
        size_hint_x: None # Let the animation control the width
        width: 0 # Start with zero width
        opacity: 0
        disabled: True

    BoxLayout:
        id: chat_panel
        orientation: 'vertical'
        # No size_hint_x needed, it will fill the remaining space

        ScrollView:
            id: chat_scroll
            scroll_type: ['bars', 'content']
            bar_width: 10
            BoxLayout:
                id: chat_box
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                spacing: 5
                # The font_name for labels is set dynamically in client.py

        BoxLayout:
            id: input_layout
            size_hint_y: None
            height: 40
            spacing: 5
            MDTextField:
                id: msg_entry
                multiline: False
                hint_text: app.tr.get('message_input_hint', "Type a message...")
                mode: "fill"
            MDIconButton:
                id: record_button
                icon: "microphone"
            MDIconButton:
                id: emoji_button
                icon: "emoticon"
            MDRaisedButton:
                id: send_button
                text: app.tr.get('send_button', 'Send')

    BoxLayout:
        id: users_panel
        orientation: 'vertical'
        size_hint_x: None # Let's fix the width for the right panel
        width: 250 # A fixed width for the user panel
        spacing: 5

        BoxLayout:
            id: users_panel_controls
            orientation: 'vertical'
            size_hint_y: None
            height: self.minimum_height
            spacing: 5
            padding: (0, 5)

            BoxLayout:
                id: group_actions_layout
                size_hint_y: None
                height: 40
                spacing: 5
            
            MDLabel:
                id: users_list_label
                text: app.tr.get('users_in_chat_label', 'Users Online')
                halign: 'center'
                size_hint_y: None
                height: 30
        
        ScrollView:
            id: users_scroll
            scroll_type: ['bars', 'content']
            bar_width: 10
            BoxLayout:
                id: users_list
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
        
        BoxLayout:
            size_hint_y: None
            height: 44
            spacing: 5
            MDIconButton:
                id: settings_button
                icon: 'cog'
            MDRaisedButton:
                id: theme_button
                text: app.tr.get('toggle_theme_button', 'Toggle Theme')